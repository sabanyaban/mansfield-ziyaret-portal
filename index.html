<!doctype html>
<html lang="tr">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>Mansfield Ziyaret Portalı</title>

<!-- Kütüphaneler -->
<script src="https://cdn.jsdelivr.net/npm/xlsx@0.20.2/dist/xlsx.full.min.js"></script>
<script src="https://unpkg.com/xlsx@0.20.2/dist/xlsx.full.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2" defer></script>

<!-- CSS Dosyası -->
<link rel="stylesheet" href="styles.css">
</head>
<body>
  <header>
    <div class="wrap row between">
      <div class="brand">
        <img id="brandLogo" alt="Mansfield"/>
        <span id="brandFallback" class="logo-fallback"></span>
        <span>Mansfield Ziyaret Portalı</span>
      </div>
      <div class="controls row">
        <span class="badge" id="clock">--:--</span>
        <button id="printBtn">Yazdır</button>
        <button id="exportBtn">XLSX Dışa Aktar</button>
        <label class="row" style="gap:8px"><input type="checkbox" id="adminToggle"/> <span>Admin modu</span></label>
      </div>
    </div>
  </header>

  <main class="wrap">
    <div class="grid">
      <!-- Filtreler -->
      <section class="card span12">
        <h2>Hızlı Filtre</h2>
        <div class="flexwrap">
          <input id="q" class="grow" placeholder="Müşteri adı / not ara"/>
          <select id="fMode" class="grow">
            <option value="">Taşıma modu (hepsi)</option>
            <option value="Sea">Deniz</option>
            <option value="Road">Kara</option>
            <option value="Air">Hava</option>
          </select>
          <select id="fStatus" class="grow">
            <option value="">Durum (hepsi)</option>
            <option>Yeni</option><option>Sıcak</option><option>Teklif Gönderildi</option>
            <option>Beklemede</option><option>Kazanıldı</option><option>Kaybedildi</option>
          </select>
          <input id="fPort" class="grow" placeholder="Liman filtrele (örn. Mersin, Hamburg)"/>
          <input id="fMinVol" class="grow" placeholder="Min yıllık hacim" type="number" min="0"/>
          <input id="fFrom" class="grow" type="date"/>
          <input id="fTo" class="grow" type="date"/>
          <button id="clearFilters">Filtreleri Temizle</button>
        </div>
      </section>

      <!-- Ziyaret Ekle -->
      <section class="card span8">
        <h2>Yeni Müşteri Ziyareti</h2>
        <div class="flexwrap">
          <input id="cName" class="grow" placeholder="Müşteri adı *"/>
          <input id="cContact" class="grow" placeholder="Yetkili kişi"/>
          <input id="cPhone" class="grow" placeholder="Telefon / e-posta"/>
        </div>

        <div class="flexwrap">
          <div class="grow">
            <h3>Taşıma Modu</h3>
            <div class="row" style="flex-wrap:wrap;gap:12px">
              <label><input type="checkbox" class="mode" value="Sea"> Deniz</label>
              <label><input type="checkbox" class="mode" value="Road"> Kara</label>
              <label><input type="checkbox" class="mode" value="Air"> Hava</label>
            </div>
          </div>
          <div class="grow">
            <h3>Durum</h3>
            <select id="cStatus">
              <option>Yeni</option><option>Sıcak</option><option>Teklif Gönderildi</option>
              <option>Beklemede</option><option>Kazanıldı</option><option>Kaybedildi</option>
            </select>
          </div>
          <div class="grow">
            <h3>Öncelik</h3>
            <select id="cPriority">
              <option>Normal</option><option>Yüksek</option><option>Düşük</option>
            </select>
          </div>
        </div>

        <!-- POL/POD -->
        <div class="flexwrap">
          <div class="grow">
            <h3>POL (Yükleme Limanı)</h3>
            <input id="polSearch" placeholder="Ara... (örn. MERSIN)"/>
            <select id="polSelect" size="8" multiple style="margin-top:6px"></select>
            <div class="row" style="gap:6px;margin-top:6px">
              <button id="polAll" type="button">Tümünü Seç</button>
              <button id="polClear" type="button">Temizle</button>
            </div>
          </div>
          <div class="grow">
            <h3>POD (Varış Limanı)</h3>
            <input id="podSearch" placeholder="Ara... (örn. HAMBURG)"/>
            <select id="podSelect" size="8" multiple style="margin-top:6px"></select>
            <div class="row" style="gap:6px;margin-top:6px">
              <button id="podAll" type="button">Tümünü Seç</button>
              <button id="podClear" type="button">Temizle</button>
            </div>
          </div>
          <div class="grow" style="min-width:220px">
            <h3>Rota</h3>
            <div class="muted">Çoklu seçim (Ctrl/Cmd/Shift). <strong>POL → POD</strong> ekle.</div>
            <button id="addRoute" style="background:linear-gradient(135deg,var(--accent2),var(--accent));color:#fff;border-color:transparent;margin-top:6px">
              POL → POD ekle
            </button>
          </div>
        </div>

        <div class="flexwrap">
          <div class="grow">
            <h3>Limanlar</h3>
            <input id="portInput" placeholder="Serbest giriş: Liman yaz ve Enter"/>
            <div id="portChips"></div>
          </div>
          <div class="grow">
            <h3>Yıllık Hacim</h3>
            <div class="row" style="gap:8px">
              <input id="cVolume" type="number" min="0" placeholder="miktar"/>
              <select id="cVolUnit">
                <option>TEU</option><option>Sefer</option><option>Ton</option>
              </select>
            </div>
            <label class="row" style="gap:8px;margin-top:8px">
              <input id="needQuote" type="checkbox"> Teklif gerektiriyor
            </label>
          </div>
        </div>

        <div class="flexwrap">
          <div class="grow">
            <h3>Ziyaret Tarihi</h3>
            <input id="cVisit" type="date"/>
          </div>
          <div class="grow">
            <h3>Takip Tarihi</h3>
            <input id="cFollow" type="date"/>
          </div>
          <div class="grow">
            <h3>Etiketler</h3>
            <input id="tagInput" placeholder="Etiket yaz ve Enter"/>
            <div id="tagChips"></div>
          </div>
        </div>
        <h3>Notlar</h3>
        <textarea id="cNotes" rows="5" placeholder="Ziyaret notları, rakipler, transit, ekipman vb."></textarea>
        <div class="row" style="justify-content:flex-end;gap:8px;margin-top:10px">
          <button id="vReset">Temizle</button>
          <button id="vSave" style="background:linear-gradient(135deg,var(--accent2),var(--accent));color:#fff;border-color:transparent">Kaydet</button>
        </div>
      </section>

      <!-- Sağ panel -->
      <section class="card span4">
        <h2>Hızlı Bağlantılar</h2>
        <ul id="linkList" style="list-style:none;padding:0;margin:0"></ul>
        <div id="linkEdit" style="display:none;margin-top:10px">
          <input id="linkText" placeholder="Görünen ad"/>
          <input id="linkUrl" placeholder=https://…/>
          <div class="row" style="justify-content:flex-end;margin-top:8px">
            <button id="linkSave" style="background:linear-gradient(135deg,var(--accent2),var(--accent));color:#fff;border-color:transparent">Ekle</button>
          </div>
        </div>
        <div class="row" style="justify-content:flex-end;margin-top:6px">
          <button id="linkAdd" style="display:none">+ Bağlantı</button>
        </div>

        <h3 style="margin-top:14px">Müşteri Notları</h3>
        <ul id="customerLinks" style="list-style:none;padding:0;margin:0"></ul>
        <p class="muted" style="margin-top:8px">İsme tıklayınca notu <strong>PDF</strong> olarak görüntüler.</p>

        <div id="logoAdmin" style="display:none;margin-top:14px">
          <h3>Logo</h3>
          <input type="file" id="logoFile" accept="image/*"/>
          <p class="muted">Logo seç → otomatik kaydedilir (yalnız bu cihaz). PDF’lere basılır.</p>

          <hr style="margin:12px 0;border:none;border-top:1px solid var(--border)">

          <h3>POL / POD Yönetimi</h3>
          <p class="muted">Her satıra bir liman yazın. Kaydet sonrası seçim listeleri güncellenir.</p>
          <h4>POL Listesi</h4>
          <textarea id="polAdmin" rows="5" style="width:100%;"></textarea>
          <h4>POD Listesi</h4>
          <textarea id="podAdmin" rows="7" style="width:100%;"></textarea>
          <div class="row" style="justify-content:flex-end;gap:8px;margin-top:8px">
            <button id="polpodSave">Kaydet</button>
            <button id="polpodReset">Varsayılana Dön</button>
          </div>
        </div>
      </section>

      <!-- Liste -->
      <section class="card span12">
        <!-- Supabase Bağlantı Durumu -->
        <div id="connectionStatus" class="connection-status">
          <span class="status-indicator" id="statusIndicator"></span>
          <span class="status-text" id="statusText">Bağlantı kontrol ediliyor...</span>
        </div>
        <h2>Müşteri Ziyaretleri</h2>
        <table class="table" id="visitTable">
          <thead>
            <tr>
              <th>No</th>
              <th>Tarih</th>
              <th>Müşteri</th>
              <th>Mod</th>
              <th>Limanlar</th>
              <th>Hacim</th>
              <th>Durum</th>
              <th>Takip</th>
              <th>Güncelleme</th>
              <th></th>
            </tr>
          </thead>
          <tbody></tbody>
        </table>
        <p class="muted">Kayıtlar bu cihazda saklanır (localStorage). XLSX/Excel XML ile dışa aktarabilirsiniz.</p>
      </section>
    </div>
    <div class="footer">© <span id="year"></span> Mansfield — Ziyaret Portalı (Yerel kullanım)</div>
  </main>

  <!-- Not güncelleme modalı -->
  <div id="editModal" class="modal">
    <div class="box">
      <h2>Notu Güncelle</h2>
      <textarea id="editNotes" rows="8" style="width:100%"></textarea>
      <div class="row" style="justify-content:flex-end;margin-top:10px">
        <button id="editCancel">Vazgeç</button>
        <button id="editSave" style="background:linear-gradient(135deg,var(--accent2),var(--accent));color:#fff;border-color:transparent">Kaydet</button>
      </div>
    </div>
  </div>

<!-- Supabase Yapılandırması -->
<script src="supabase-config.js"></script>
<!-- Supabase Servis Katmanı -->
<script src="supabase-service.js"></script>
<!-- Ana JavaScript Dosyası -->
<script src="script.js"></script>
</body>
</html>
